webmssdk.es5.js:2 WebSocket connection to 'wss://www.doubao.com/chat/Create%20WebSocket' failed: 
_0x52f81 @ webmssdk.es5.js:2
_0x4f412f @ webmssdk.es5.js:2
w_0x44a25d @ webmssdk.es5.js:2
_0x1c7dd0 @ webmssdk.es5.js:2
webmssdk.es5.js:2 WebSocket connection to 'wss://www.doubao.com/chat/Create%20WebSocket' failed: 
_0x52f81 @ webmssdk.es5.js:2
_0x4f412f @ webmssdk.es5.js:2
w_0x44a25d @ webmssdk.es5.js:2
_0x50c6ce @ webmssdk.es5.js:2
(function() {
    'use strict';

    console.log(">>> [Hook] Doubao a_bogus Injector started");

    // 1. 特征字符表 (从你的分析中提取)
    const CHAR_MAP = "Dkdpgh4ZKsQB80/Mfvw36XI1R25+WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe";

    // 3. Hook window.bdms (如果有的话)
    let _bdms = window.bdms;
    
    // 如果 bdms 已经存在，直接劫持
    if (_bdms) {
        hookSigner(_bdms);
    }

    // 同时监听赋值，防止被覆盖或还没初始化
    Object.defineProperty(window, 'bdms', {
        get: function() { return _bdms; },
        set: function(val) {
            console.log(">>> [Hook] window.bdms 被赋值!", val);
            _bdms = val;
            hookSigner(val);
        },
        configurable: true
    });

    function hookSigner(bdmsObj) {
        if (bdmsObj && bdmsObj.frontierSign) {
            console.log(">>> [Hook] 发现 frontierSign，正在劫持...");
            const originalSign = bdmsObj.frontierSign;
            bdmsObj.frontierSign = function(args) {
                console.log(">>> [Call] frontierSign 调用 参数:", args);
                
                // 执行原函数
                const res = originalSign.apply(this, arguments);
                
                console.log(">>> [Return] frontierSign 结果:", res);
                if (res) {
                    if (res['X-Bogus']) console.log("    ✅ X-Bogus:", res['X-Bogus']);
                    if (res['a_bogus']) console.log("    ✅ a_bogus:", res['a_bogus']);
                }
                return res;
            };
        }
    }

    // 4. 搜索内存中的特征 (在控制台手动运行)
    window.findBogusEncoder = function() {
        console.log(">>> 开始搜索特征字符串...");
        console.log(`
        手动调试建议：
        1. 打开 Sources 面板。
        2. 按 Ctrl+Shift+F (全局搜索)。
        3. 搜索特征串: "${CHAR_MAP}"
        4. 在搜索结果处打断点。
        5. 触发一次对话请求。
        6. 当断点停下时，查看调用栈(Call Stack)，找到上层的 _0x... 函数。
        7. 观察那个函数的输入参数 (Uint8Array)，那就是加密前的原始数据！
        `);
    };

    setTimeout(window.findBogusEncoder, 2000);

})();

VM22098:4 >>> [Hook] Doubao a_bogus Injector started
VM22098:30 >>> [Hook] 发现 frontierSign，正在劫持...
VM22098:32 Uncaught TypeError: Cannot set property frontierSign of #<Object> which has only a getter
    at hookSigner (<anonymous>:32:34)
    at <anonymous>:14:9
    at <anonymous>:65:3